
<p id="notice"><%= render 'layouts/flash_message' %></p>

<div class="row wrapper border-bottom white-bg page-heading">
  <div class="col-lg-10">
    <h2>Profil <%if @subject.vip?%><span class="vip_text"><b>VIP</b></span> <% end %> Kontaktu</h2>
    <ol class="breadcrumb">
      <li>
        <%= link_to 'Home', root_path %>
      </li>

      <li class="active">
        <strong>Profil <%if @subject.vip?%><span class="vip_text">VIP</span> <% end %> Kontaktu</strong>
      </li>
    </ol>
  </div>
  <div class="col-lg-2">

  </div>
</div>
<div class="row m-b-lg m-t-lg">

  <div class="col-md-6">
    <div class="profile-image">
      <i class="fa fa-building-o fa-5x" aria-hidden="true"></i>

    </div>

    <div class="profile-info">
      <div class="">
        <div>

          <h2 class="no-margins">
            <%= @subject.name %>

                            
                            <a data-toggle="modal" data-target="#editSubjektModal"  aria-expanded="false">
                                <i class="fa fa-pencil-square-o"></i>
                            </a>
                           
                           
                        
          </h2>
          <br>
          <p>Sídlo: <b><%= @subject.site %></b></p>
          <p>IČO: <b><%= @subject.ico %></b></p>
          <p>Okres: <b><%= @subject.district.name if @subject.district.present? %></b></p>
          <p>Typ: <b><%= @subject.subjtype.name if @subject.subjtype.present? %></b></p>
          <p>Projektový zámer: <b><%= @subject.project_targets_string %></b></p>

          
        </div>
       
      </div>
    </div>
  </div>
  
</div>

<div class="row">

    <div class="col-lg-3">

        <div class="ibox">
            <div class="ibox-title">
            <h5>Osoby</h5>
           </div>
         <div class="ibox-content">
<% @people.each do |person|%>
                
                    <div class="row">
                      <div class="col-lg-12">
                 
                 
                        <h3><strong><%= person.first_name + ' ' + person.last_name %></strong></h3>
                        <p><i class="fa fa-map-marker"></i> <%= @subject.site %></p>
                        
                            <strong><%= @subject.name %></strong><br>
                            @ <%= person.email %><br>
                            @ <%= person.email2 %><br>
                            <i class="fa fa-mobile" aria-hidden="true"></i> <%= person.cellphone %><br>
                            <i class="fa fa-phone" aria-hidden="true"></i></i> <%= person.phone %><br>
                            
                        
                     
                    </div>
                    </div>    
          <% if @people.count > 1 %><hr> <%end %>  
           <% end %> 
         </div>
</div>

</div>



<div class="col-lg-3">
 <div class="ibox">
   
                                    <div class="ibox-title">
                                        <h5>Dokumenty</h5>
                                      
                                    </div>
                                    <div class="ibox-content table-responsive">
                                        <table class="table table-hover no-margins">
                                            <thead>
                                            <tr>
                                                <th>Súbor</th>
                                                <th>Veľkosť</th>
                                                
                                            </tr>
                                            </thead>
                                            <tbody>
                                           <% @documents.each do |document| %>
                                            <tr>
                                                <td><small><%= link_to document.file_name, download_doc_path(document.id), data: {turbolinks: false} %></small></td>
                                                <td><%= number_to_human_size(document.file_size) if document.file_size.present? %></td>
                                            </tr>
                                           <% end %>
                                            </tbody>
                                        </table>
                                    </div>
                                
</div>

</div>

<div class="col-lg-6">
 <div class="ibox">
    <div class="ibox-title">
    <h5>Komunikácia</h5>
   </div>
   <div class="ibox-content ">

                                <div class="feed-activity-list">
                                  <% @communications.each do |comm| %>
                                    <div class="feed-element">
                                        <div>
                                            <small class="float-right text-navy">Pred <%= time_ago_in_words(comm.created_at) %></small>
                                            <strong><%= comm.user.name if comm.user.present? %></strong>
                                            <div><strong>Kľúčové slovo: </strong><%= comm.keyword %></div>
                                            <div><%= comm.about %></div>
                                            <small class="text-muted"><%= (I18n.localize comm.created_at) %></small>
                                        </div>
                                    </div>
                                    <% end %>
                                   

                                </div>
                            
</div>
</div>

</div>






</div>
<div class="row">
  <h4><center>Média</center></h4>
  <div class="col-lg-3">
     <div class="ibox">
    <div class="ibox-title">
    <h5>Súbory</h5>
   </div>
   <div class="ibox-content table-responsive">
     <table class="table table-hover no-margins">
                                            <thead>
                                            <tr>
                                                <th>Názov</th>
                                                <th>Veľkosť</th>
                                                
                                            </tr>
                                            </thead>
                                            <tbody>
                                           <% @media.each do |medium| %>
                                            <tr>
                                                <td><small><%= link_to medium.file_name, download_media_path(medium.id), data: {turbolinks: false} %></small></td>
                                                <td><%= number_to_human_size(medium.file_size) if medium.file_size.present? %></td>
                                            </tr>
                                           <% end %>
                                            </tbody>
                                        </table>
   </div>
 </div>
</div>
<div class="col-lg-9">
  <div class="ibox">
    <div class="ibox-title">
    <h5>Galéria</h5>
   </div>
   <div class="ibox-content ">
    <div class="lightBoxGallery">
      <% @media.each do |medium| %>
      
      <a href="<%= medium.file_url.remove("/public") if medium.file_url.present? %>" title="<%= medium.file_name%>" data-gallery="" class="mediumshow"><img src="<%= medium.file_url.remove("/public") if medium.file_url.present? %>" height="42" >
        </a>
      <% end %>
      <div id="blueimp-gallery" class="blueimp-gallery">
                                <div class="slides"></div>
                                <h3 class="title"></h3>
                                <a class="prev">‹</a>
                                <a class="next">›</a>
                                <a class="close">×</a>
                                <a class="play-pause"></a>
                                <ol class="indicator"></ol>
                            </div>
    </div>
   </div>
 </div>
  </div>
  </div>


<!-- edit modal -->
<div id="editSubjektModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h2 class="modal-title" id="myModalLabel">Uprav subjekt</h2>
        <div class="alert alert-danger alert-dismissable">
          <button class="close" aria-hidden="true" data-dismiss="alert" type="button">×</button>
          Polia vysvietené na červeno sú povinné
        </div>
      </div>
      <div class="modal-body">
        <div class="form-group has-error">
          <form name="edit_subjekt_form" accept-charset="utf-8">
            <input style="visibility:hidden" type="text" name="editsubjektID" id="editsubjektID" value="<%= @subject.id %>" readonly>
           <label>Názov:</label><input type="text" name="edit_subjname" id="edit_subjname" class="form-control" placeholder="Názov subjektu" value="<%= @subject.name %>" required /><br>
           <label>Okres:</label><%= select_tag 'edit_okres', options_from_collection_for_select(@districts, 'id', 'name',@subject.district_id), class: 'form-control', id: 'edit_subjdistrict' %>
         </br>
         <label>Typ Subjektu:</label><%= select_tag 'edit_typ_subjektu', options_from_collection_for_select(@subjtypes, 'id', 'name',@subject.subjtype_id), class: 'form-control', id: 'edit_subjtype' %>
       </br>
     </div>
     <label>Sídlo:</label><input type="text" name="edit_subjsite" id="edit_subjsite" class="form-control" placeholder="Sídlo subjektu" value="<%= @subject.site %>" /><br>
     <label>IČO:</label><input type="number" name="edit_subjico" id="edit_subjico" class="form-control" onkeyup="if(!this.checkValidity()){this.value=\'\';alert(\'Vložte číslo!\')};" placeholder="IČO ak má subjekt pridelené" value="<%= @subject.ico %>"/><br>
     <label class="">VIP <input id="edit_isvip" type="checkbox" class="icheckbox_square-green" <% if @subject.vip? %>checked<% end %>/></label><br>
     <label>Poznámka:</label><input type="text" name="edit_subjnote" id="edit_subjnote" class="form-control" placeholder="Poznámka" value="<%= @subject.note %>" /><br>
     <label>Počet obyvateľov ak je obec:</label><input type="text" name="edit_subjobyv" id="edit_subjobyv" class="form-control" placeholder="Počet obyvateľov v prípade že ide o obec" value="<%= @subject.citizen_count %>" /><br>
     <hr>
     <label>Projektový zámer</label><%= select_tag 'project_targets_edit', options_from_collection_for_select(@projecttargets, 'id', 'name', @subject.project_targets), class: 'form-control chosen-select',multiple: true, id: 'project_targets_edit', "data-placeholder": "Vyber projektový zámer..." %>
       <br><br>       

    <input  class="editcontact btn btn-success" value="Uprav" /> 

   </form>

 </div>
</div>
</div>
</div>


<script>

var ready = function() {

$(".mediumshow").onclick = function (event) {
    event = event || window.event;
    var target = event.target || event.srcElement,
        link = target.src ? target.parentNode : target,
        options = {index: link, event: event},
        links = this.getElementsByTagName('a');
    blueimp.Gallery(links, options);
};

$('.chosen-select').chosen({width: "100%"});

$("#project_targets_edit").chosen().change(function(e, params){
 $project_targets  = $("#project_targets_edit").chosen().val();

 //console.log($project_targets)
});

$('.editcontact').on('click',function(event){
          //console.log(event.target.id);
          
          $edit_subjectID = $('#editsubjektID').val();
          $edit_subjname = $('#edit_subjname').val();
          $edit_subjdistrict = $('#edit_subjdistrict').val();
          $edit_subjtype = $('#edit_subjtype').val();
          $edit_subjsite = $('#edit_subjsite').val(); 
          $edit_subjico = $('#edit_subjico').val(); 
          $edit_subjnote = $('#edit_subjnote').val(); 
          if ($('#edit_isvip').is(":checked")) {$edit_isvip = true;} else {$edit_isvip = false;}
          $edit_subjobyv = $('#edit_subjobyv').val(); 
          
          var $targets = 0;

          if (typeof $project_targets !== 'undefined') {
          $targets = $project_targets;
            }

          



          
          $.ajax({
            type: "POST",
            url: "/modal_edit_subj",
            data: {
              edit_subjectid: $edit_subjectID,
              edit_subjname: $edit_subjname,
              edit_subjdistrict: $edit_subjdistrict,
              edit_subjtype: $edit_subjtype,
              edit_subjsite: $edit_subjsite,
              edit_subjico: $edit_subjico,
              edit_subjnote: $edit_subjnote,
              edit_isvip: $edit_isvip,
              edit_subjobyv: $edit_subjobyv,
              edit_project_targets: $targets              

            },

            success:function(data){
              if (data.status == "ok")
              {
                alert("Subjekt bol upravený" );
                location.reload();
                
              }
              else { alert(data.status);}


            }
          });
          



        });

};
$(".subjects.show_subject_profile").ready(ready);
$(".subjects.show_subject_profile").on('turbolinks:load', ready);
</script>